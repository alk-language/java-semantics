askIth(out a:array<int>, i:int) : int
requires a.size() > 0 && 0 <= i && i < a.size()-1
ensures a[i] <= a[i+1]
ensures result > 0 ==> result == i
{
    if (a[i] > a[i+1]) {
        temp = a[i];
        a[i] = a[i+1];
        a[i+1] = temp;
        return i;
    }
    return 0;
}

sorted(out a) {
    return forall j:int :: forall k:int ::
           0 <= j && j <= last && last < k &&
           k < a.size() ==> a[j] <= a[k];
}

bubbleSort(out a: array<int>) {
    last = a.size()-1;
    while (last > 0)
    invariant sorted(a)
    {
        n1 = last;
        i = 0;
        while (i < n1)
        invariant forall j:int ::
        0 <= j && j < i ==> a[j] <= a[i]
        {
            last = askIth(a, i);
            i = i + 1;
        }
    }
}